<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Completed Tasks | Task Management System</title>
    <style>
        /* Completed Tasks Page Specific Styling */

/* Completed Table Header */
#completedTable th {
    background: #1e3c72;
    color: white;
    text-align: left;
    padding: 15px;
}

/* Table rows */
#completedTable td {
    padding: 12px;
}

/* Alternating row colors */
#completedTable tr:nth-child(even) {
    background: #f2f2f2;
}

/* Completed status */
#completedTable .completed {
    color: green;
    font-weight: bold;
}

/* Table container styling for spacing */
.content h2 {
    margin-bottom: 20px;
}

/* Add some shadow to table */
#completedTable {
    width: 100%;
    background: white;
    border-collapse: collapse;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

    </style>
</head>
<body>

<header class="topbar">
    <h1>Task Management System</h1>
    <a href="#" id="logout" class="logout">Logout</a>
</header>

<div class="dashboard">

    <aside class="sidebar">
        <ul>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="tasks.html">My Tasks</a></li>
            <li><a href="add-task.html">Add Task</a></li>
            <li class="active"><a href="complete.html">Completed Tasks</a></li>
            <li><a href="profile.html">Profile</a></li>
        </ul>
    </aside>

    <main class="content">
        <h2>Completed Tasks</h2>

        <table id="completedTable">
            <tr>
                <th>#</th>
                <th>Task Name</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Due Date</th>
            </tr>
        </table>
    </main>
</div>

<script>
async function ensureSession(){
    try{
        const res = await fetch("api/me.php",{credentials:"include"});
        const data = await res.json();
        if(!data.ok){ window.location.href = "login.html"; return null; }
        return data.user;
    }catch(e){
        window.location.href = "login.html";
        return null;
    }
}
async function loadCompleted(){
    const user = await ensureSession();
    if(!user) return;
    const table = document.getElementById("completedTable");
    try{
        const res = await fetch("api/tasks.php?status=Completed",{credentials:"include"});
        const data = await res.json();
        if(data.ok){
            let idx = 0;
            data.tasks.forEach(t=>{
                idx++;
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${idx}</td>
                    <td>${t.name}</td>
                    <td class="completed">${t.status}</td>
                    <td>${t.priority||""}</td>
                    <td>${t.due_date||""}</td>
                `;
            });
        }
    }catch(e){}
}
document.getElementById("logout").addEventListener("click", async function(e){
    e.preventDefault();
    try{ await fetch("api/logout.php",{credentials:"include"});}catch(e){}
    window.location.href = "login.html";
});
loadCompleted();
</script>

</body>
</html>
